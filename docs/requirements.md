# 文章校正 Web アプリ 要件定義書（修正版）

## 1. プロジェクト概要

### 目的

職場で LLM に直接アクセスできない環境において、個人的に利用可能な日本語文章校正 Web アプリケーションを開発する。

### 技術スタック

- **フレームワーク**: Next.js 15（App Router、TypeScript）
- **スタイリング**: Tailwind CSS v4 + shadcn/ui
- **校正エンジン**: Gemini API（@google/genai SDK）
- **API 管理**: Next.js API Routes
- **状態管理**: 必要に応じて（Zustand 推奨）
- **その他ライブラリ**
  - アニメーション: Framer Motion
  - アイコン: Lucide React
  - テキスト差分表示: react-diff-viewer
  - サニタイズ: DOMPurify（XSS 対策）

---

## 2. 機能要件

### 2.1 基本機能（MVP）

#### 2.1.1 UI 構成

- **ヘッダー**: ロゴ、タイトル、設定ボタン（歯車）
- **左パネル**: 編集可能テキストエリア、入力文字数カウンター
- **中央**: 「文章を校正」「校正結果を適用」ボタン、ローディング表示
- **右パネル**: 校正結果エリア、出力文字数カウンター
- **校正理由**: 「校正理由を見る」ボタン → モーダル表示
- **設定モーダル**: 文体・校正レベル・API キー設定
- **レスポンシブ**: モバイル縦配置、デスクトップ左右配置

#### 2.1.2 校正機能

**校正レベル**

1. 誤字脱字修正
2. 文法エラー修正
3. 自然な日本語表現への改善
4. 冗長性排除・読みやすさ向上
5. ビジネス文書に適切な敬語・丁寧語調整

**文体設定**

- MVP: ビジネス文書（既定）
- 将来: カジュアル、学術、報告書

#### 2.1.3 校正結果表示

- 校正後本文
- 修正概要（1–2 行）
- 詳細理由（モーダル）

#### 2.1.4 基本操作

- 「文章を校正」: Gemini API に送信
- 「校正結果を適用」: 結果を左パネルへコピー
- **部分校正は未対応（将来拡張）**

### 2.2 開発・運用支援機能

- **プロンプト管理**: 編集・保存・復元・テスト
- **設定機能**
  - Gemini API キー（環境変数管理）
  - 文体・校正レベル選択
  - カスタムプロンプト設定

---

## 3. 非機能要件

### 3.1 セキュリティ

- API キーはサーバー環境変数管理（クライアント非露出）
- API 通信は Next.js API Routes 経由
- HTTPS 必須
- ユーザー文書は保存せず即時破棄
- `dangerouslySetInnerHTML` 禁止、DOMPurify でサニタイズ

### 3.2 パフォーマンス

- 1000 文字の校正を 5 秒以内に完了（目標）
- 遅延時はローディング表示、タイムアウト時はエラーメッセージ
- レスポンシブ対応

### 3.3 ユーザビリティ

- 直感的 UI
- **通知システム**: 成功/エラー/情報を右上表示（3 秒で自動非表示）
- **アニメーション**: ローディング、モーダル、ボタン状態
- **ショートカット**
  - `Ctrl+Enter` / `Cmd+Enter`: 校正実行
  - `Escape`: モーダル閉じる
- API エラー時の明確なメッセージ表示

---

## 4. 技術仕様

### 4.1 Gemini API 連携

**プロンプト例**

```

あなたは日本語の校正・校閲の専門家です。以下の文章をビジネス文書として適切に校正してください。

校正内容:

1. 誤字脱字の修正
2. 文法修正
3. 自然な表現への改善
4. 敬語・丁寧語の調整
5. 文章構造の最適化

出力形式:

- correctedText: 校正後の文章
- summary: 校正概要（1–2 行）
- details: 詳細な校正理由

対象文章:
{input_text}

```

### 4.2 データフロー

1. ユーザーが入力
2. 「文章を校正」押下
3. フロント → `/api/proofread` POST
4. API Route → Gemini API
5. 応答（本文/概要/詳細）返却
6. 右パネルに表示
7. モーダルで詳細理由確認
8. 適用で左パネルに反映

### 4.3 API 仕様

#### `POST /api/proofread`

**Request**

```json
{
  "text": "校正対象の文章",
  "style": "business"
}
```

**Response**

```json
{
  "correctedText": "校正後の文章",
  "summary": "概要: 誤字2箇所、表現改善3箇所",
  "details": "詳細な修正理由と改善ポイント"
}
```

**エラーハンドリング**

- 400: text 欠如/長すぎ
- 401/403: API キー未設定
- 408/504: タイムアウト
- 429: レート制限
- 500: 内部エラー

---

## 5. 将来拡張

### 5.1 機能

- 文体追加（カジュアル・学術・報告書）
- 部分校正
- 修正箇所ハイライト
- 差分表示
- 保存/履歴/エクスポート
- 校正統計・分析
- 用語集

### 5.2 UI/UX

- ダークモード
- カスタムテーマ
- 詳細差分表示
- 音声入力
- モバイル最適化

---

## 6. 開発フェーズ

- **Phase 1 (MVP)**: UI 実装、Gemini 連携、全文校正、修正理由表示
- **Phase 2**: UX 改善、文体選択拡張、部分校正導入
- **Phase 3**: 保存/履歴、エクスポート、分析機能

---

## 7. 留意事項

### 7.1 ライブラリ採用理由

- **shadcn/ui**: 高品質 UI コンポーネント
- **TailwindCSS v4**: 最新構成でレスポンシブ対応
- **Framer Motion**: 滑らかなアニメーション
- **Lucide React**: 一貫性あるアイコン
- **react-diff-viewer**: 差分表示用（拡張時）

### 7.2 環境変数

```bash
# .env.local
GEMINI_API_KEY=your_api_key_here
GEMINI_MODEL=gemini-2.5-flash
TIMEOUT_MS=10000
```

### 7.3 開発上の注意

- プロンプト調整を容易に
- 個人情報をログに残さない
- エラー時のフォールバック必須
- モーダル表示はモバイル最適化
- MVP は校正機能に集中、差分/ハイライトは後回し
