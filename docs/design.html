<!--あくまでデザイン用のサンプルhtml。これを参考にUI/UXを構築する。 -->
<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kotonoha - AI文章校正アシスタント</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              border: "hsl(214.3 31.8% 91.4%)",
              input: "hsl(214.3 31.8% 91.4%)",
              ring: "hsl(222.2 84% 4.9%)",
              background: "hsl(0 0% 100%)",
              foreground: "hsl(222.2 84% 4.9%)",
              primary: {
                DEFAULT: "hsl(222.2 47.4% 11.2%)",
                foreground: "hsl(210 40% 98%)",
              },
              secondary: {
                DEFAULT: "hsl(210 40% 96%)",
                foreground: "hsl(222.2 84% 4.9%)",
              },
              destructive: {
                DEFAULT: "hsl(0 84.2% 60.2%)",
                foreground: "hsl(210 40% 98%)",
              },
              muted: {
                DEFAULT: "hsl(210 40% 96%)",
                foreground: "hsl(215.4 16.3% 46.9%)",
              },
              accent: {
                DEFAULT: "hsl(210 40% 96%)",
                foreground: "hsl(222.2 84% 4.9%)",
              },
              popover: {
                DEFAULT: "hsl(0 0% 100%)",
                foreground: "hsl(222.2 84% 4.9%)",
              },
              card: {
                DEFAULT: "hsl(0 0% 100%)",
                foreground: "hsl(222.2 84% 4.9%)",
              },
            },
            borderRadius: {
              lg: "var(--radius)",
              md: "calc(var(--radius) - 2px)",
              sm: "calc(var(--radius) - 4px)",
            },
            keyframes: {
              "accordion-down": {
                from: { height: 0 },
                to: { height: "var(--radix-accordion-content-height)" },
              },
              "accordion-up": {
                from: { height: "var(--radix-accordion-content-height)" },
                to: { height: 0 },
              },
              "fade-in": {
                "0%": { opacity: "0", transform: "translateY(10px)" },
                "100%": { opacity: "1", transform: "translateY(0)" },
              },
              "slide-in": {
                "0%": { transform: "translateX(-100%)" },
                "100%": { transform: "translateX(0)" },
              },
              "pulse-glow": {
                "0%, 100%": { boxShadow: "0 0 5px rgba(59, 130, 246, 0.5)" },
                "50%": { boxShadow: "0 0 20px rgba(59, 130, 246, 0.8)" },
              },
            },
            animation: {
              "accordion-down": "accordion-down 0.2s ease-out",
              "accordion-up": "accordion-up 0.2s ease-out",
              "fade-in": "fade-in 0.3s ease-out",
              "slide-in": "slide-in 0.3s ease-out",
              "pulse-glow": "pulse-glow 2s ease-in-out infinite",
            },
          },
        },
      };
    </script>
    <style>
      body {
        box-sizing: border-box;
      }

      :root {
        --radius: 0.5rem;
      }

      .highlight {
        background: linear-gradient(120deg, #dbeafe 0%, #fef3c7 100%);
        border-bottom: 2px solid #3b82f6;
        cursor: pointer;
        transition: all 0.2s ease;
        border-radius: 3px;
        padding: 1px 2px;
      }

      .highlight:hover {
        background: linear-gradient(120deg, #bfdbfe 0%, #fde68a 100%);
        transform: translateY(-1px);
      }

      .modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 50;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }

      .modal-overlay.active {
        opacity: 1;
        visibility: visible;
      }

      .modal-content {
        background: white;
        border-radius: 12px;
        padding: 24px;
        max-width: 500px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        transform: scale(0.9) translateY(20px);
        transition: all 0.3s ease;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      }

      .modal-overlay.active .modal-content {
        transform: scale(1) translateY(0);
      }

      .spinner {
        border: 2px solid #f3f4f6;
        border-top: 2px solid #9333ea;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .text-area {
        resize: none;
        font-family:
          "Inter",
          -apple-system,
          BlinkMacSystemFont,
          "Segoe UI",
          sans-serif;
      }

      .glass-effect {
        backdrop-filter: blur(10px);
        background: rgba(255, 255, 255, 0.8);
      }
    </style>
  </head>
  <body
    class="bg-gradient-to-br from-purple-50 via-pink-50 to-rose-100 min-h-screen"
  >
    <!-- Header -->
    <header class="border-b bg-white/80 backdrop-blur-sm sticky top-0 z-40">
      <div class="container mx-auto px-4 py-4">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-3">
            <div
              class="w-10 h-10 bg-gradient-to-r from-purple-600 to-pink-600 rounded-lg flex items-center justify-center"
            >
              <svg
                class="w-6 h-6 text-white"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"
                ></path>
              </svg>
            </div>
            <div>
              <h1
                class="text-xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent"
              >
                Kotonoha
              </h1>
              <p class="text-sm text-gray-600">
                言葉を美しく磨く AI校正アシスタント
              </p>
            </div>
          </div>
          <button
            id="settingsBtn"
            class="p-2 hover:bg-gray-100 rounded-lg transition-colors"
          >
            <svg
              class="w-5 h-5 text-gray-600"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"
              ></path>
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
              ></path>
            </svg>
          </button>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
      <!-- Desktop Layout -->
      <div class="hidden lg:grid lg:grid-cols-5 gap-6 h-[calc(100vh-200px)]">
        <!-- Left Panel - Input -->
        <div
          class="col-span-2 bg-white rounded-xl shadow-sm border border-gray-200 flex flex-col"
        >
          <div
            class="p-4 border-b border-gray-200 flex items-center justify-between"
          >
            <div class="flex items-center space-x-2">
              <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
              <h2 class="font-semibold text-gray-900">校正前の文章</h2>
            </div>
            <span
              id="inputCharCount"
              class="text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded"
              >0文字</span
            >
          </div>
          <div class="flex-1 p-4">
            <textarea
              id="inputText"
              class="text-area w-full h-full border-0 resize-none focus:outline-none text-gray-900 placeholder-gray-400 leading-relaxed"
              placeholder="校正したい文章をここに入力してください。

例：
・ビジネスメール
・報告書
・提案書
・その他の日本語文書

Ctrl+Enterで校正を実行できます。"
            ></textarea>
          </div>
        </div>

        <!-- Center Panel - Controls -->
        <div
          class="col-span-1 flex flex-col items-center justify-center space-y-4"
        >
          <button
            id="correctBtn"
            class="w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-medium py-3 px-4 rounded-lg transition-all duration-200 transform hover:scale-105 shadow-lg hover:shadow-xl flex items-center justify-center space-x-2"
          >
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
              ></path>
            </svg>
            <span>文章を校正</span>
          </button>

          <div
            id="loading"
            class="hidden flex items-center space-x-2 text-purple-600"
          >
            <div class="spinner"></div>
            <span class="text-sm font-medium">校正中...</span>
          </div>

          <button
            id="applyBtn"
            disabled
            class="w-full bg-gray-100 text-gray-400 font-medium py-3 px-4 rounded-lg transition-all duration-200 flex items-center justify-center space-x-2 disabled:cursor-not-allowed"
          >
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"
              ></path>
            </svg>
            <span>校正結果を適用</span>
          </button>
        </div>

        <!-- Right Panel - Results -->
        <div
          class="col-span-2 bg-white rounded-xl shadow-sm border border-gray-200 flex flex-col"
        >
          <div
            class="p-4 border-b border-gray-200 flex items-center justify-between"
          >
            <div class="flex items-center space-x-2">
              <div class="w-2 h-2 bg-green-500 rounded-full"></div>
              <h2 class="font-semibold text-gray-900">校正結果</h2>
            </div>
            <span
              id="outputCharCount"
              class="text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded"
              >0文字</span
            >
          </div>
          <div class="flex-1 p-4 overflow-y-auto">
            <div id="resultArea" class="h-full">
              <div
                class="flex flex-col items-center justify-center h-full text-gray-400"
              >
                <svg
                  class="w-16 h-16 mb-4"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="1"
                    d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                  ></path>
                </svg>
                <p class="text-center">校正結果がここに表示されます</p>
                <p class="text-sm text-center mt-2">
                  校正後の文章と概要説明が表示されます
                </p>
              </div>
            </div>
          </div>
          <div
            id="summarySection"
            class="hidden border-t border-gray-200 p-4 bg-purple-50"
          >
            <div class="flex items-start space-x-3">
              <div
                class="flex-shrink-0 w-6 h-6 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center"
              >
                <svg
                  class="w-4 h-4"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                  ></path>
                </svg>
              </div>
              <div class="flex-1">
                <h3 class="text-sm font-medium text-purple-900 mb-1">
                  校正概要
                </h3>
                <p id="summaryText" class="text-sm text-purple-800"></p>
                <button
                  id="detailsBtn"
                  class="mt-2 text-sm text-purple-600 hover:text-purple-800 font-medium underline"
                >
                  詳細な校正理由を見る
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Mobile Layout -->
      <div class="lg:hidden space-y-6">
        <!-- Input Panel -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200">
          <div
            class="p-4 border-b border-gray-200 flex items-center justify-between"
          >
            <div class="flex items-center space-x-2">
              <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
              <h2 class="font-semibold text-gray-900">校正前の文章</h2>
            </div>
            <span
              id="inputCharCountMobile"
              class="text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded"
              >0文字</span
            >
          </div>
          <div class="p-4">
            <textarea
              id="inputTextMobile"
              class="text-area w-full h-64 border-0 resize-none focus:outline-none text-gray-900 placeholder-gray-400 leading-relaxed"
              placeholder="校正したい文章をここに入力してください..."
            ></textarea>
          </div>
        </div>

        <!-- Control Buttons -->
        <div class="flex flex-col space-y-3">
          <button
            id="correctBtnMobile"
            class="w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-medium py-4 px-4 rounded-lg transition-all duration-200 flex items-center justify-center space-x-2"
          >
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
              ></path>
            </svg>
            <span>文章を校正</span>
          </button>

          <div
            id="loadingMobile"
            class="hidden flex items-center justify-center space-x-2 text-purple-600 py-4"
          >
            <div class="spinner"></div>
            <span class="text-sm font-medium">校正中...</span>
          </div>

          <button
            id="applyBtnMobile"
            disabled
            class="w-full bg-gray-100 text-gray-400 font-medium py-3 px-4 rounded-lg transition-all duration-200 flex items-center justify-center space-x-2 disabled:cursor-not-allowed"
          >
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"
              ></path>
            </svg>
            <span>校正結果を適用</span>
          </button>
        </div>

        <!-- Results Panel -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200">
          <div
            class="p-4 border-b border-gray-200 flex items-center justify-between"
          >
            <div class="flex items-center space-x-2">
              <div class="w-2 h-2 bg-green-500 rounded-full"></div>
              <h2 class="font-semibold text-gray-900">校正結果</h2>
            </div>
            <span
              id="outputCharCountMobile"
              class="text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded"
              >0文字</span
            >
          </div>
          <div class="p-4 min-h-64">
            <div id="resultAreaMobile">
              <div
                class="flex flex-col items-center justify-center h-32 text-gray-400"
              >
                <svg
                  class="w-12 h-12 mb-2"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="1"
                    d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                  ></path>
                </svg>
                <p class="text-center text-sm">校正結果がここに表示されます</p>
              </div>
            </div>
          </div>
          <div
            id="summarySectionMobile"
            class="hidden border-t border-gray-200 p-4 bg-purple-50"
          >
            <div class="flex items-start space-x-3">
              <div
                class="flex-shrink-0 w-6 h-6 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center"
              >
                <svg
                  class="w-4 h-4"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                  ></path>
                </svg>
              </div>
              <div class="flex-1">
                <h3 class="text-sm font-medium text-purple-900 mb-1">
                  校正概要
                </h3>
                <p id="summaryTextMobile" class="text-sm text-purple-800"></p>
                <button
                  id="detailsBtnMobile"
                  class="mt-2 text-sm text-purple-600 hover:text-purple-800 font-medium underline"
                >
                  詳細な校正理由を見る
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal-overlay">
      <div class="modal-content">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-lg font-semibold text-gray-900">設定</h3>
          <button id="closeSettingsBtn" class="p-1 hover:bg-gray-100 rounded">
            <svg
              class="w-5 h-5 text-gray-500"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              ></path>
            </svg>
          </button>
        </div>

        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >文書スタイル</label
            >
            <select
              id="documentStyle"
              class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
            >
              <option value="business">ビジネス文書（デフォルト）</option>
              <option value="casual">カジュアル</option>
              <option value="academic">学術的</option>
              <option value="report">報告書</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >校正レベル</label
            >
            <select
              id="correctionLevel"
              class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
            >
              <option value="basic">基本（誤字脱字・文法）</option>
              <option value="standard">標準（表現改善含む）</option>
              <option value="advanced">高度（構造最適化含む）</option>
            </select>
          </div>
        </div>

        <div
          class="flex justify-end space-x-3 mt-6 pt-4 border-t border-gray-200"
        >
          <button
            id="cancelSettingsBtn"
            class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"
          >
            キャンセル
          </button>
          <button
            id="saveSettingsBtn"
            class="px-4 py-2 bg-purple-600 text-white hover:bg-purple-700 rounded-lg transition-colors"
          >
            保存
          </button>
        </div>
      </div>
    </div>

    <!-- Correction Details Modal -->
    <div id="reasonModal" class="modal-overlay">
      <div class="modal-content">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-gray-900">詳細な校正理由</h3>
          <button id="closeReasonBtn" class="p-1 hover:bg-gray-100 rounded">
            <svg
              class="w-5 h-5 text-gray-500"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              ></path>
            </svg>
          </button>
        </div>
        <div id="reasonContent" class="space-y-4">
          <!-- 詳細な校正理由の内容がここに表示される -->
        </div>
      </div>
    </div>

    <script>
      class TextCorrector {
        constructor() {
          this.corrections = [];
          this.initializeElements();
          this.bindEvents();
          this.loadSettings();
          this.syncTextAreas();
        }

        initializeElements() {
          // Desktop elements
          this.inputText = document.getElementById("inputText");
          this.resultArea = document.getElementById("resultArea");
          this.correctBtn = document.getElementById("correctBtn");
          this.applyBtn = document.getElementById("applyBtn");
          this.loading = document.getElementById("loading");
          this.inputCharCount = document.getElementById("inputCharCount");
          this.outputCharCount = document.getElementById("outputCharCount");
          this.summarySection = document.getElementById("summarySection");
          this.summaryText = document.getElementById("summaryText");
          this.detailsBtn = document.getElementById("detailsBtn");

          // Mobile elements
          this.inputTextMobile = document.getElementById("inputTextMobile");
          this.resultAreaMobile = document.getElementById("resultAreaMobile");
          this.correctBtnMobile = document.getElementById("correctBtnMobile");
          this.applyBtnMobile = document.getElementById("applyBtnMobile");
          this.loadingMobile = document.getElementById("loadingMobile");
          this.inputCharCountMobile = document.getElementById(
            "inputCharCountMobile"
          );
          this.outputCharCountMobile = document.getElementById(
            "outputCharCountMobile"
          );
          this.summarySectionMobile = document.getElementById(
            "summarySectionMobile"
          );
          this.summaryTextMobile = document.getElementById("summaryTextMobile");
          this.detailsBtnMobile = document.getElementById("detailsBtnMobile");

          // Modal elements
          this.settingsModal = document.getElementById("settingsModal");
          this.reasonModal = document.getElementById("reasonModal");
          this.settingsBtn = document.getElementById("settingsBtn");
          this.closeSettingsBtn = document.getElementById("closeSettingsBtn");
          this.closeReasonBtn = document.getElementById("closeReasonBtn");
          this.cancelSettingsBtn = document.getElementById("cancelSettingsBtn");
          this.saveSettingsBtn = document.getElementById("saveSettingsBtn");
          this.documentStyle = document.getElementById("documentStyle");
          this.correctionLevel = document.getElementById("correctionLevel");
          this.reasonContent = document.getElementById("reasonContent");
        }

        bindEvents() {
          // Desktop events
          this.correctBtn.addEventListener("click", () => this.correctText());
          this.applyBtn.addEventListener("click", () => this.applyCorrection());
          this.detailsBtn.addEventListener("click", () =>
            this.showReasonModal()
          );
          this.inputText.addEventListener("input", () =>
            this.updateCharCount()
          );

          // Mobile events
          this.correctBtnMobile.addEventListener("click", () =>
            this.correctText()
          );
          this.applyBtnMobile.addEventListener("click", () =>
            this.applyCorrection()
          );
          this.detailsBtnMobile.addEventListener("click", () =>
            this.showReasonModal()
          );
          this.inputTextMobile.addEventListener("input", () =>
            this.updateCharCount()
          );

          // Modal events
          this.settingsBtn.addEventListener("click", () =>
            this.showSettingsModal()
          );
          this.closeSettingsBtn.addEventListener("click", () =>
            this.hideSettingsModal()
          );
          this.closeReasonBtn.addEventListener("click", () =>
            this.hideReasonModal()
          );
          this.cancelSettingsBtn.addEventListener("click", () =>
            this.hideSettingsModal()
          );
          this.saveSettingsBtn.addEventListener("click", () =>
            this.saveSettings()
          );

          // Close modals on overlay click
          this.settingsModal.addEventListener("click", (e) => {
            if (e.target === this.settingsModal) this.hideSettingsModal();
          });
          this.reasonModal.addEventListener("click", (e) => {
            if (e.target === this.reasonModal) this.hideReasonModal();
          });

          // Keyboard shortcuts
          document.addEventListener("keydown", (e) => {
            if (e.ctrlKey && e.key === "Enter") {
              e.preventDefault();
              this.correctText();
            }
            if (e.key === "Escape") {
              this.hideSettingsModal();
              this.hideReasonModal();
            }
          });
        }

        syncTextAreas() {
          // Sync desktop and mobile text areas
          this.inputText.addEventListener("input", () => {
            this.inputTextMobile.value = this.inputText.value;
          });
          this.inputTextMobile.addEventListener("input", () => {
            this.inputText.value = this.inputTextMobile.value;
          });
        }

        updateCharCount() {
          const count = this.inputText.value.length;
          this.inputCharCount.textContent = `${count}文字`;
          this.inputCharCountMobile.textContent = `${count}文字`;
        }

        async correctText() {
          const text = this.inputText.value.trim();

          if (!text) {
            this.showNotification("校正する文章を入力してください。", "error");
            return;
          }

          this.setLoading(true);

          try {
            // Simulate API call
            await new Promise((resolve) => setTimeout(resolve, 2000));

            const result = this.generateDemoCorrection(text);
            this.displayResult(
              result.correctedText,
              result.summary,
              result.details
            );
            this.enableButtons();
            this.showNotification("校正が完了しました！", "success");
          } catch (error) {
            this.showNotification(`校正エラー: ${error.message}`, "error");
          } finally {
            this.setLoading(false);
          }
        }

        generateDemoCorrection(originalText) {
          let correctedText = originalText;
          let correctionCount = 0;

          // Demo corrections
          const replacements = [
            { from: /です。/g, to: "でございます。", type: "敬語表現" },
            { from: /します/g, to: "いたします", type: "謙譲語" },
            { from: /思います/g, to: "考えております", type: "ビジネス表現" },
            { from: /すいません/g, to: "申し訳ございません", type: "敬語表現" },
            { from: /やります/g, to: "実施いたします", type: "ビジネス表現" },
            {
              from: /わかりました/g,
              to: "承知いたしました",
              type: "ビジネス表現",
            },
          ];

          const appliedCorrections = [];
          replacements.forEach((replacement) => {
            if (replacement.from.test(correctedText)) {
              const matches = [...correctedText.matchAll(replacement.from)];
              correctionCount += matches.length;
              appliedCorrections.push(replacement.type);
              correctedText = correctedText.replace(
                replacement.from,
                replacement.to
              );
            }
          });

          const uniqueTypes = [...new Set(appliedCorrections)];
          const summary =
            correctionCount > 0
              ? `${correctionCount}箇所の修正を行いました（${uniqueTypes.join(
                  "、"
                )}の改善）`
              : "修正箇所はありませんでした。文章は適切に書かれています。";

          const details =
            correctionCount > 0
              ? `以下の観点から文章を校正いたしました：

1. **敬語表現の統一**: ビジネス文書に適した丁寧な敬語表現に修正
2. **謙譲語の適用**: 相手に対する敬意を示す適切な謙譲語を使用
3. **ビジネス表現の最適化**: より専門的で洗練された表現に改善
4. **文体の統一**: 一貫性のある文体で読みやすさを向上

これらの修正により、より適切なビジネス文書としての品質を向上させました。`
              : "入力された文章は既に適切なビジネス文書として書かれており、特に修正の必要はありませんでした。敬語表現、文法、表現方法すべてが適切です。";

          return { correctedText, summary, details };
        }

        displayResult(correctedText, summary, details) {
          this.resultArea.innerHTML = `<div class="prose max-w-none leading-relaxed text-gray-900">${correctedText}</div>`;
          this.resultAreaMobile.innerHTML = `<div class="prose max-w-none leading-relaxed text-gray-900">${correctedText}</div>`;

          this.outputCharCount.textContent = `${correctedText.length}文字`;
          this.outputCharCountMobile.textContent = `${correctedText.length}文字`;

          // Show summary sections
          this.summarySection.classList.remove("hidden");
          this.summarySectionMobile.classList.remove("hidden");

          this.summaryText.textContent = summary;
          this.summaryTextMobile.textContent = summary;

          // Store details for modal
          this.correctionDetails = details;
        }

        applyCorrection() {
          const plainText =
            this.resultArea.textContent || this.resultArea.innerText;
          this.inputText.value = plainText;
          this.inputTextMobile.value = plainText;
          this.updateCharCount();
          this.disableButtons();
          this.showNotification("校正結果を適用しました！", "success");
        }

        enableButtons() {
          this.applyBtn.disabled = false;
          this.applyBtn.classList.remove("bg-gray-100", "text-gray-400");
          this.applyBtn.classList.add(
            "bg-green-600",
            "hover:bg-green-700",
            "text-white"
          );

          this.applyBtnMobile.disabled = false;
          this.applyBtnMobile.classList.remove("bg-gray-100", "text-gray-400");
          this.applyBtnMobile.classList.add(
            "bg-green-600",
            "hover:bg-green-700",
            "text-white"
          );
        }

        disableButtons() {
          this.applyBtn.disabled = true;
          this.applyBtn.classList.add("bg-gray-100", "text-gray-400");
          this.applyBtn.classList.remove(
            "bg-green-600",
            "hover:bg-green-700",
            "text-white"
          );

          this.applyBtnMobile.disabled = true;
          this.applyBtnMobile.classList.add("bg-gray-100", "text-gray-400");
          this.applyBtnMobile.classList.remove(
            "bg-green-600",
            "hover:bg-green-700",
            "text-white"
          );

          // Hide summary sections
          this.summarySection.classList.add("hidden");
          this.summarySectionMobile.classList.add("hidden");
        }

        setLoading(isLoading) {
          this.loading.classList.toggle("hidden", !isLoading);
          this.loadingMobile.classList.toggle("hidden", !isLoading);
          this.correctBtn.disabled = isLoading;
          this.correctBtnMobile.disabled = isLoading;
        }

        showSettingsModal() {
          this.settingsModal.classList.add("active");
          document.body.style.overflow = "hidden";
        }

        hideSettingsModal() {
          this.settingsModal.classList.remove("active");
          document.body.style.overflow = "";
        }

        showReasonModal() {
          if (!this.correctionDetails) return;

          const content = `
                    <div class="prose max-w-none">
                        <div class="whitespace-pre-line text-gray-800 leading-relaxed">
                            ${this.correctionDetails}
                        </div>
                    </div>
                `;

          this.reasonContent.innerHTML = content;
          this.reasonModal.classList.add("active");
          document.body.style.overflow = "hidden";
        }

        hideReasonModal() {
          this.reasonModal.classList.remove("active");
          document.body.style.overflow = "";
        }

        saveSettings() {
          const settings = {
            documentStyle: this.documentStyle.value,
            correctionLevel: this.correctionLevel.value,
          };
          localStorage.setItem(
            "textCorrectorSettings",
            JSON.stringify(settings)
          );
          this.hideSettingsModal();
          this.showNotification("設定を保存しました", "success");
        }

        loadSettings() {
          const settings = localStorage.getItem("textCorrectorSettings");
          if (settings) {
            const parsed = JSON.parse(settings);
            this.documentStyle.value = parsed.documentStyle || "business";
            this.correctionLevel.value = parsed.correctionLevel || "standard";
          }
        }

        showNotification(message, type = "info") {
          const notification = document.createElement("div");
          notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg transition-all duration-300 transform translate-x-full ${
            type === "success"
              ? "bg-green-500 text-white"
              : type === "error"
                ? "bg-red-500 text-white"
                : "bg-blue-500 text-white"
          }`;
          notification.textContent = message;

          document.body.appendChild(notification);

          setTimeout(() => {
            notification.classList.remove("translate-x-full");
          }, 100);

          setTimeout(() => {
            notification.classList.add("translate-x-full");
            setTimeout(() => {
              document.body.removeChild(notification);
            }, 300);
          }, 3000);
        }
      }

      // Initialize the application
      document.addEventListener("DOMContentLoaded", () => {
        new TextCorrector();
      });
    </script>
    <script>
      (function () {
        function c() {
          var b = a.contentDocument || a.contentWindow.document;
          if (b) {
            var d = b.createElement("script");
            d.innerHTML =
              "window.__CF$cv$params={r:'98526499f73dfcdb',t:'MTc1ODg4NTg0Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";
            b.getElementsByTagName("head")[0].appendChild(d);
          }
        }
        if (document.body) {
          var a = document.createElement("iframe");
          a.height = 1;
          a.width = 1;
          a.style.position = "absolute";
          a.style.top = 0;
          a.style.left = 0;
          a.style.border = "none";
          a.style.visibility = "hidden";
          document.body.appendChild(a);
          if ("loading" !== document.readyState) c();
          else if (window.addEventListener)
            document.addEventListener("DOMContentLoaded", c);
          else {
            var e = document.onreadystatechange || function () {};
            document.onreadystatechange = function (b) {
              e(b);
              "loading" !== document.readyState &&
                ((document.onreadystatechange = e), c());
            };
          }
        }
      })();
    </script>
  </body>
</html>
